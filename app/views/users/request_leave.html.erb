<script>
  function clearDate() {
    document.getElementById('todate').value = "";
    document.getElementById('fromdate').value = "";
  }

  function calcBusinessDays(dDate1, dDate2) { // input given as Date objects
    var iWeeks, iDateDiff, iAdjust = 0;
    if (dDate2 < dDate1){ alert('Please enter valid date!'); clearDate(); return 0;}// error code if dates transposed

    var iWeekday1 = dDate1.getDay(); // day of week
    var iWeekday2 = dDate2.getDay();
    iWeekday1 = (iWeekday1 == 0) ? 7 : iWeekday1; // change Sunday from 0 to 7
    iWeekday2 = (iWeekday2 == 0) ? 7 : iWeekday2;
    if ((iWeekday1 > 5) && (iWeekday2 > 5)) iAdjust = 1; // adjustment if both days on weekend
    iWeekday1 = (iWeekday1 > 5) ? 5 : iWeekday1; // only count weekdays
    iWeekday2 = (iWeekday2 > 5) ? 5 : iWeekday2;

    // calculate differnece in weeks (1000mS * 60sec * 60min * 24hrs * 7 days = 604800000)
    iWeeks = Math.floor((dDate2.getTime() - dDate1.getTime()) / 604800000)

    if (iWeekday1 <= iWeekday2) {
      iDateDiff = (iWeeks * 5) + (iWeekday2 - iWeekday1)
      } else {
      iDateDiff = ((iWeeks + 1) * 5) - (iWeekday1 - iWeekday2)
    }

    iDateDiff -= iAdjust // take into account both days on weekend
    if (isNaN(iDateDiff))  { return 0; }
    return (iDateDiff + 1); // add 1 because dates are inclusive
  }
</script>

<script>
  $(document).ready(function () {
    $("#noOfDays").val(calcBusinessDays(new Date($("#fromdate").val()),new Date($("#todate").val())));
    $(".date").change(function(){
      $("#noOfDays").val(calcBusinessDays(new Date($("#fromdate").val()),new Date($("#todate").val())));
    });
    $(".date").datepicker({
      changeMonth:true,
      changeYear:true,
      dateFormat:'MM dd,yy'
    });
	});

</script>
  
<%= form_tag({:controller => "users", :action => "send_email", :id => @user.id}, { :method => "post", :class => 'form-horizontal' }) do %>  
  <table>
  	<tr>
  		<td>
  
  			<div>
  				<h2>&emsp;&emsp;&emsp;&emsp;Leave Request</h2>
  
                <div style="width:110px">Requested By:</div>
                <input type=text size=20 name="username" value="<%= @user.user_name.capitalize %>" ><br>
  				<br>
  				<label> From Date </label>
  				<input type="text" size=20 name="fromdate" id="fromdate" class="date" >
  				<br><br>
  				<label> To Date </label>
  				<input type="text" size=20 name="todate" id="todate" class="date">
  				<br><br>
          <label>Total leaves</label>
  				<input type="text" name="noofdays" id="noOfDays" size=20 >
  				<br><br>
          <label>Leave Description </label>
          <textarea name="description" rows="8" cols="40"></textarea>
  				<br><br>
  				<%= submit_tag "Send For Approval", :class => 'btn btn-primary' %>  				  			
  				&emsp; 				          
                <%= submit_tag "Clear", :class => 'btn', :type => 'reset' %>  				
  			</div>
  
  		</td>
  		<td>
  			<div>
  				<h3> Your Leave Details :</h3>
  				<table>
  					<tr>
  						<td>Total Leaves Alloted &nbsp; : &nbsp;</td>
  						<td>
  							<input type=text size=20 value="18">
  						</td>
  					</tr>
  					<tr>
  						<td>Paid Leaves Remaining &nbsp; : &nbsp;</td>
  						<td>
  					    <input type=text size=20 value="<%= @paid_leaves_remaining %>">
  						</td>
  					</tr>
  					<tr>
  						<td>Unpaid Leaves Taken&nbsp; : &nbsp;</td>
  						<td>
  							<input type=text size=20 value="<%= @unpaid_leaves_taken %>">
  						</td>
  					</tr>
  				</table>
  			</div>
  
  		</td>
  	</tr>
  </table>	
<% end %>

